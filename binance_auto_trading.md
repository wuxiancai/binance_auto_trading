# 基于币安 API 的自动化交易系统开发文档

## 1. 项目概述

本项目旨在开发一个基于 **币安现货/永续合约 API**
的自动化交易系统。该系统部署在 **Ubuntu Server 24.04 云服务器** 上，使用
**WebSocket 实时行情** 和 **REST API 下单**，实现稳定、高效的策略执行。

默认目标交易对：**BTC/USDT 永续合约**\
交易所地址：[Binance Futures
BTC/USDT](https://www.binance.com/zh-CN/futures/BTCUSDT)\
API 文档：(https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/websocket-api-general-info)
URL:(wss://ws-fapi.binance.com/ws-fapi/v1)
API KEY 默认为空
------------------------------------------------------------------------

## 2. 策略逻辑说明

系统默认基于 **15 分钟 K 线 BOLL（布林带）指标** 进行交易(15 分钟可以通过参数配置更改为其他任何时间)：

1.  **计算指标**
    -   使用 15 分钟 K 线计算 BOLL 指标：
        -   `UP` = 中轨 + 2 × 标准差\
        -   `DN` = 中轨 - 2 × 标准差\
        -   中轨 = 20 根 K 线的均值
        - ddof默认为 0

2.  **交易规则**
    -   当 **实时价格突破实时 BOLL UP**，设置状态为: **突破 UP**，然后**回落至实时 BOLL UP** 时 → **买入空单**,设置状态为: **持有空仓**:\
        -   当 **实时价格跌破实时 BOLL DN**，设置状态为: **跌破 DN**，然后**反弹至实时 BOLL DN** 时 →**卖出空单止盈，并买入多单**,设置状态为:**持有多仓**\
                当**实时价格跌破实时 BOLL DN**时 →**卖出多仓止损**,设置状态为: **跌破 DN**，然后**反弹至实时 BOLL DN** 时 →**买入多单**,设置状态为:**持有多仓**
                当**实时价格突破实时 BOLL UP**，设置状态为: **突破 UP**，然后**回落至实时 BOLL UP** 时 → **卖出多仓止盈,并买入空单**,设置状态为: **持有空仓**
            当 **实时价格再次突破实时 BOLL UP**时 → **卖出空单止损**,然后设置状态为:**突破 UP**，然后**回落至实时 BOLL UP** 时 → **买入空单**,设置状态为: **持有空仓**
    -   当 **实时价格跌破实时 BOLL DN**，设置状态为: **跌破 DN**，然后**反弹至实时 BOLL DN** 时 →**买入多单**,设置状态为:**持有多仓**\ 
        -   ....
    -   上述逻辑循环执行，实现**区间震荡高抛低吸**。

## 3. 技术选型

-   **语言**：Python 3.11 or Python 3.12,适配 UBUNTU SERVER22.04 及以上版本
-   **依赖库**：
    -   `websockets`（实时行情订阅）\
    -   `pandas`（数据计算与指标）\
    -   `numpy`（数学计算）\
    -   `python-binance`（REST 下单接口）\
    -   `asyncio`（异步并发，提高反应速度）\
-   **数据库**：SQLite（保存 K 线和交易日志）\
-   **部署环境**：Ubuntu Server 24.04 LTS

## 4. 程序运行逻辑
- 程序启动时,先检查数据库是否有数据,如果没有,则使用币安 API 获取50 根历史 K 线数据,保存到数据库中,同时使用websoket api订阅实时价格
- 交易时,根据实时价格和实时 BOLL 指标,判断是否需要下单,并执行下单操作
- 下单操作成功后,更新数据库中的持仓状态和交易记录
- 程序运行过程中,如果发生异常,则记录日志并继续运行
- 程序可以通过配置文件设置交易对、时间间隔、BOLL 参数等
- 程序可以通过配置文件设置交易金额等
- 程序可以通过配置文件设置是否开启自动重启,如果开启,则在程序异常退出时自动重启

## 5. 程序部署
- 程序部署在 Ubuntu Server 24.04 云服务器上
- 程序使用 systemd 服务管理,可以通过 systemctl 命令启动、停止、重启程序
- 创建auto_deploy.sh脚本,用于自动一键部署程序,包括创建虚拟环境,安装依赖、配置文件替换、服务重启等

## 6. 程序监控与维护
- 程序运行过程中,可以通过日志文件查看程序运行状态和交易记录
- 可以使用 systemctl 命令查看程序服务状态,并使用 journalctl 命令查看日志
- 可以使用 auto_deploy.sh 脚本进行程序更新和维护,包括重启服务、更新代码、安装依赖等

## 7. 程序安全与权限
- 程序运行时,使用非 root 用户权限,避免权限问题
- 程序使用配置文件设置 API 密钥和密码,确保密钥安全

## 8. 程序其他注意事项
- 程序运行时,需要保持网络连接,否则可能会影响交易执行
- 程序运行时,需要保持数据库连接,否则可能会影响交易记录的保存
- 程序运行时,需要保持配置文件的正确性,否则可能会影响程序的正常运行
- 使用 FLASK 框架,创建一个 WEB 页面,用于展示交易状态、持仓信息、交易记录,日志信息等
- 可以在 WEB 页面上查看程序运行状态、服务器系统 CPU、内存、磁盘等信息
- 所有配置使用config.py文件,在WEB页面上显示配置信息
- WEB 页面必须美观,简洁,且响应式,可以在 PC、平板、手机等设备上正常访问

重要:
考虑到要测试程序是否正常,需要增加模拟交易功能,即不实际下单,而只是记录下订单信息,用于测试和调试
- 程序可以通过配置文件设置是否开启模拟交易,如果开启,则在下单时,只记录下订单信息,而不实际下单
- 可以在 WEB 页面上查看模拟交易记录,用于测试和调试